<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>To-Do List (GitHub API Demo)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background: #f6f8fa;
        }
        h1 {
            color: #333;
        }
        #todo-list-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        .todo-item {
            background: #fff;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.07);
            font-size: 1rem;
            word-break: break-word;
        }
        #add-form {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }
        #add-input {
            flex: 1;
            padding: 9px;
            border: 1px solid #bbb;
            border-radius: 5px;
            font-size: 1rem;
        }
        #add-btn {
            padding: 9px 20px;
            border: none;
            background: #2563eb;
            color: #fff;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
        }
        #add-btn:active {
            background: #1e40af;
        }
        .error {
            color: #c00;
            margin-top: 10px;
        }
        .success {
            color: #0a0;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>To-Do List (GitHub API Demo)</h1>
    <form id="add-form" autocomplete="off">
        <input type="text" id="add-input" placeholder="Add a new item..." required />
        <button type="submit" id="add-btn">Add</button>
    </form>
    <div id="todo-list-container"></div>
    <div class="error" id="error-msg"></div>
    <div class="success" id="success-msg"></div>

    <script>
        // --- CONFIGURATION ---
        const GITHUB_OWNER = "kaliliveuser";
        const GITHUB_REPO = "sandbox";
        const TODO_FILE_PATH = "todo-list.txt";
        // For demo purposes only. NEVER share or commit your PAT.
        const GITHUB_TOKEN = "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";
        // ---------------------

        let fileSha = null;
        let todoList = [];

        async function fetchToDoList() {
            clearMsg();
            const url = `${TODO_FILE_PATH}`;
            const headers = {
                "Accept": "application/vnd.github.v3+json",
                "Authorization": `token ${GITHUB_TOKEN}`
            };
            try {
                const res = await fetch(url, { headers });
                if (!res.ok) throw new Error(`Failed to fetch: ${res.status}`);
                const data = await res.json();
                fileSha = data.sha;
                const content = atob(data.content.replace(/\n/g, ''));
                todoList = content.split('\n').map(line => line.trim()).filter(Boolean);
                displayToDoList(todoList);
            } catch (err) {
                document.getElementById('error-msg').textContent = 'Could not load the to-do list from GitHub. ' + err.message;
                document.getElementById('todo-list-container').innerHTML = "";
            }
        }

        function displayToDoList(items) {
            const container = document.getElementById('todo-list-container');
            container.innerHTML = '';
            if (items.length === 0) {
                container.innerHTML = '<div class="todo-item" style="opacity:0.6;">No items yet.</div>';
                return;
            }
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'todo-item';
                div.textContent = item;
                container.appendChild(div);
            });
        }

        // Add a new item and update todo-list.txt via GitHub API
        async function addItemToGitHub(newItem) {
            clearMsg();
            if (!fileSha) {
                document.getElementById('error-msg').textContent = "Cannot update file: SHA missing.";
                return;
            }
            // Compose new content
            const newContentArr = [...todoList, newItem.trim()];
            const newContent = newContentArr.join('\n');
            const base64Content = btoa(unescape(encodeURIComponent(newContent)));
            const url = `${TODO_FILE_PATH}`;
            const payload = {
                message: `Add to-do item: ${newItem}`,
                content: base64Content,
                sha: fileSha
            };
            const headers = {
                "Accept": "application/vnd.github.v3+json",
                "Authorization": `token ${GITHUB_TOKEN}`,
                "Content-Type": "application/json"
            };
            try {
                const res = await fetch(url, {
                    method: "PUT",
                    headers,
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error(`Failed to update: ${res.status}`);
                const data = await res.json();
                fileSha = data.content.sha;
                todoList.push(newItem.trim());
                displayToDoList(todoList);
                document.getElementById('success-msg').textContent = "To-do item added and saved to GitHub!";
            } catch (err) {
                document.getElementById('error-msg').textContent = 'Could not update the to-do list on GitHub. ' + err.message;
            }
        }

        function clearMsg() {
            document.getElementById('error-msg').textContent = '';
            document.getElementById('success-msg').textContent = '';
        }

        document.getElementById('add-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const input = document.getElementById('add-input');
            const newItem = input.value;
            if (!newItem.trim()) return;
            await addItemToGitHub(newItem);
            input.value = '';
        });

        // Load from GitHub on start
        window.addEventListener('DOMContentLoaded', fetchToDoList);
    </script>
</body>
</html>
