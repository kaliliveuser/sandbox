<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lava Lamp Blob</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Three.js setup
        let scene, camera, renderer, blob;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            camera.position.z = 5;

            // Blob geometry and material
            const geometry = new THREE.IcosahedronGeometry(1, 64); // More subdivisions for smoother blob

            // Custom shader for undulation and color change
            const vertexShader = `
                uniform float time;
                uniform float speed;
                uniform float amplitude;
                varying vec3 vNormal;
                varying vec3 vPosition;

                void main() {
                    vNormal = normal;
                    vPosition = position;
                    vec3 newPosition = position + normal * (sin(position.x * 5.0 + time * speed) * amplitude +
                                                            cos(position.y * 5.0 + time * speed) * amplitude +
                                                            sin(position.z * 5.0 + time * speed) * amplitude);
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
                }
            `;

            const fragmentShader = `
                uniform float time;
                uniform vec3 color1;
                uniform vec3 color2;
                uniform vec3 color3;
                uniform vec3 color4;
                uniform vec3 color5;
                uniform vec3 lightColor;
                uniform vec3 specularColor;
                uniform float shininess;
                varying vec3 vNormal;
                varying vec3 vPosition;

                void main() {
                    // Smoothly interpolate between much darker purple colors
                    vec3 color = mix(color1, color2, (sin(time * 0.1) + 1.0) / 2.0);
                    color = mix(color, color3, (cos(time * 0.08) + 1.0) / 2.0);
                    color = mix(color, color4, (sin(time * 0.06) + 1.0) / 2.0);
                    color = mix(color, color5, (cos(time * 0.04) + 1.0) / 2.0);

                    // Add some basic shading based on normal and light direction
                    vec3 lightDirection = normalize(vec3(0.0, 1.0, 0.0)); // Light from directly above
                    float diffuse = max(dot(vNormal, lightDirection), 0.0);

                    // Specular lighting
                    vec3 viewDirection = normalize(cameraPosition - vPosition);
                    vec3 reflectDirection = reflect(-lightDirection, vNormal);
                    float spec = pow(max(dot(viewDirection, reflectDirection), 0.0), shininess);
                    vec3 specular = specularColor * spec;

                    gl_FragColor = vec4(color * (0.4 + 0.6 * diffuse) + specular, 1.0); // Adjust shading intensity
                }
            `;

            const darkerPurpleColors = [
                new THREE.Color(0x2A0A5E), // Very Dark Purple
                new THREE.Color(0x3A0B6A), // Slightly less dark
                new THREE.Color(0x4A0C76), // Even less dark
                new THREE.Color(0x5A0D82), // Darker Indigo
                new THREE.Color(0x6A0E8E)  // Darker Violet
            ];

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0.0 },
                    speed: { value: 0.5 },
                    amplitude: { value: 0.1 },
                    color1: { value: darkerPurpleColors[0] },
                    color2: { value: darkerPurpleColors[1] },
                    color3: { value: darkerPurpleColors[2] },
                    color4: { value: darkerPurpleColors[3] },
                    color5: { value: darkerPurpleColors[4] },
                    lightColor: { value: new THREE.Color(0xffffff) },
                    specularColor: { value: new THREE.Color(0xffffff) },
                    shininess: { value: 30.0 }
                },
                vertexShader: vertexShader,
                fragmentShader: fragmentShader,
                wireframe: false
            });

            blob = new THREE.Mesh(geometry, material);
            scene.add(blob);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x101010); // Very dim ambient light
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5); // Increased intensity for direct light
            directionalLight.position.set(0, 1, 0).normalize(); // Light from directly above
            scene.add(directionalLight);

            // Handle window resizing
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            // Update uniforms for animation
            blob.material.uniforms.time.value += 0.01;

            // Simple up and down movement
            blob.position.y = Math.sin(blob.material.uniforms.time.value * 0.5) * 0.5;

            renderer.render(scene, camera);
        }

        init();
        animate();
    </script>
</body>
</html>
