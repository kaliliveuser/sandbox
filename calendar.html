<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Countdown Calendar</title>
    <style>
        :root {
            --bg-color: #2c3e50;
            --box-past: #34495e;
            --box-future: #ecf0f1;
            --box-holiday: #e74c3c;
            --box-today: #3498db;
            --shadow-light: rgba(255, 255, 255, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.3);
            --text-past: #7f8c8d;
            --text-future: #2c3e50;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevents body scroll, grid handles it */
        }

        header {
            color: white;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        h1 { margin: 0; font-size: 1.5rem; text-transform: uppercase; letter-spacing: 2px; }
        
        #grid-container {
            display: grid;
            /* Auto-fit creates as many columns as fit */
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 8px;
            overflow-y: auto;
            padding-right: 5px; /* Space for scrollbar */
            flex-grow: 1;
            perspective: 1000px;
        }

        /* Scrollbar Styling */
        #grid-container::-webkit-scrollbar { width: 8px; }
        #grid-container::-webkit-scrollbar-thumb { background: #7f8c8d; border-radius: 4px; }
        #grid-container::-webkit-scrollbar-track { background: var(--bg-color); }

        .day-box {
            position: relative;
            background-color: var(--box-future);
            border-radius: 4px;
            height: 60px; /* Aspect ratio control */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            
            /* 3D Bevel Effect */
            box-shadow: 
                inset 2px 2px 5px rgba(255,255,255,0.7),
                inset -2px -2px 5px rgba(0,0,0,0.2),
                3px 3px 5px var(--shadow-dark);
            
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--text-future);
        }

        .day-box:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 
                inset 2px 2px 5px rgba(255,255,255,0.8),
                inset -2px -2px 5px rgba(0,0,0,0.2),
                6px 6px 12px var(--shadow-dark);
            z-index: 10;
        }

        /* Past Days */
        .day-box.past {
            background-color: var(--box-past);
            color: var(--text-past);
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.5); /* Pressed look */
            transform: none;
        }
        .day-box.past:hover {
            transform: none;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.5);
        }

        /* Today */
        .day-box.today {
            background-color: var(--box-today);
            color: white;
            box-shadow: 0 0 15px var(--box-today);
            border: 2px solid white;
        }

        /* Holidays */
        .day-box.holiday {
            background-color: var(--box-holiday);
            color: white;
        }

        /* Tooltip */
        #tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            pointer-events: none;
            font-size: 0.9rem;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            border: 1px solid #555;
            max-width: 250px;
        }

        .tooltip-date { color: #aaa; font-size: 0.8rem; margin-bottom: 4px; display: block;}
        .tooltip-event { color: #f1c40f; font-weight: bold; margin-top: 4px; display: block; }
        .tooltip-countdown { font-size: 0.8rem; font-style: italic; }

    </style>
</head>
<body>

    <header>
        <h1 id="year-title">202X Grid</h1>
        <div style="font-size: 0.9rem; opacity: 0.8;">Hover blocks for details</div>
    </header>

    <div id="grid-container">
        <!-- Grid items generated by JS -->
    </div>

    <div id="tooltip"></div>

<script>
    /**
     * CONFIGURATION
     * Add or remove events here. 
     * Use 'MM-DD' format for fixed dates.
     * Variable holidays (like Thanksgiving) are calculated in the script, 
     * but you can override them here if needed.
     */
    const fixedHolidays = [
        { date: '01-01', name: "New Year's Day" },
        { date: '02-14', name: "Valentine's Day" },
        { date: '07-01', name: "Canada Day" },
        { date: '09-30', name: "Truth and Reconciliation" },
        { date: '10-31', name: "Halloween" },
        { date: '11-11', name: "Remembrance Day" },
        { date: '12-25', name: "Christmas Day" },
        { date: '12-26', name: "Boxing Day" }
    ];

    const container = document.getElementById('grid-container');
    const tooltip = document.getElementById('tooltip');
    const title = document.getElementById('year-title');

    // Helper: Get nth Monday of a month (for Labour Day, Thanksgiving, etc)
    function getNthDayOfMonth(year, month, dayOfWeek, n) {
        const date = new Date(year, month, 1);
        let count = 0;
        while (date.getMonth() === month) {
            if (date.getDay() === dayOfWeek) {
                count++;
                if (count === n) return new Date(date);
            }
            date.setDate(date.getDate() + 1);
        }
        return null;
    }

    // Helper: Get Monday before a date (for Victoria Day)
    function getMondayBefore(year, month, day) {
        const date = new Date(year, month, day);
        const dayOfWeek = date.getDay(); // 0 is Sunday, 1 is Monday
        const diff = (dayOfWeek === 0 ? 6 : dayOfWeek - 1) + 7; // Go back to previous Monday
        date.setDate(date.getDate() - diff);
        return date;
    }

    // Helper: Calculate Good Friday (Easter - 2 days)
    // Simple Gaussian algorithm for Easter
    function getGoodFriday(year) {
        const a = year % 19;
        const b = Math.floor(year / 100);
        const c = year % 100;
        const d = Math.floor(b / 4);
        const e = b % 4;
        const f = Math.floor((b + 8) / 25);
        const g = Math.floor((b - f + 1) / 3);
        const h = (19 * a + b - d - g + 15) % 30;
        const i = Math.floor(c / 4);
        const k = c % 4;
        const l = (32 + 2 * e + 2 * i - h - k) % 7;
        const m = Math.floor((a + 11 * h + 22 * l) / 451);
        const month = Math.floor((h + l - 7 * m + 114) / 31) - 1; // 0-indexed
        const day = ((h + l - 7 * m + 114) % 31) + 1;
        
        const easter = new Date(year, month, day);
        easter.setDate(easter.getDate() - 2); // Good Friday is 2 days before
        return easter;
    }

    function generateCalendar() {
        const today = new Date();
        const currentYear = today.getFullYear();
        title.innerText = `${currentYear} Countdown`;

        // 1. Compile all holidays for the current year
        let allEvents = [...fixedHolidays];

        // Format Date to MM-DD
        const fmt = (d) => {
            let mm = (d.getMonth() + 1).toString().padStart(2, '0');
            let dd = d.getDate().toString().padStart(2, '0');
            return `${mm}-${dd}`;
        };

        // Add variable Canadian holidays
        const goodFriday = getGoodFriday(currentYear);
        const victoriaDay = getMondayBefore(currentYear, 4, 25); // Monday before May 25
        const labourDay = getNthDayOfMonth(currentYear, 8, 1, 1); // 1st Mon in Sept
        const thanksgiving = getNthDayOfMonth(currentYear, 9, 1, 2); // 2nd Mon in Oct
        
        allEvents.push({ date: fmt(goodFriday), name: "Good Friday" });
        allEvents.push({ date: fmt(victoriaDay), name: "Victoria Day" });
        allEvents.push({ date: fmt(labourDay), name: "Labour Day" });
        allEvents.push({ date: fmt(thanksgiving), name: "Thanksgiving" });

        // Convert events array to a Map for O(1) lookup
        const eventMap = {};
        allEvents.forEach(e => eventMap[e.date] = e.name);

        // 2. Generate Grid
        const startOfYear = new Date(currentYear, 0, 1);
        const endOfYear = new Date(currentYear, 11, 31);
        
        // Calculate total days for countdown logic
        const msPerDay = 1000 * 60 * 60 * 24;
        const totalDays = Math.round((endOfYear - startOfYear) / msPerDay) + 1;

        let currentDateLoop = new Date(startOfYear);
        let dayCount = 0;

        // Clean container
        container.innerHTML = '';

        while (currentDateLoop <= endOfYear) {
            dayCount++;
            
            // Basic data
            const dateStr = fmt(currentDateLoop);
            const fullDateStr = currentDateLoop.toDateString();
            const daysRemaining = totalDays - dayCount;
            const eventName = eventMap[dateStr];
            
            // Compare dates (strip time for comparison)
            const isToday = currentDateLoop.toDateString() === today.toDateString();
            const isPast = currentDateLoop < today && !isToday;
            
            // Create Element
            const box = document.createElement('div');
            box.classList.add('day-box');
            
            // Add Classes
            if (isPast) box.classList.add('past');
            if (isToday) box.classList.add('today');
            if (eventName) box.classList.add('holiday');

            // Visual Content: Show Days Remaining (Countdown)
            // If it's the last day, show 0
            box.innerText = daysRemaining;

            // Store data for tooltip
            box.dataset.date = fullDateStr;
            box.dataset.remaining = daysRemaining;
            if (eventName) box.dataset.event = eventName;

            // Add Interaction
            box.addEventListener('mousemove', (e) => showTooltip(e, box));
            box.addEventListener('mouseleave', hideTooltip);

            container.appendChild(box);

            // Increment loop
            currentDateLoop.setDate(currentDateLoop.getDate() + 1);
        }
    }

    function showTooltip(e, box) {
        const date = box.dataset.date;
        const remaining = box.dataset.remaining;
        const event = box.dataset.event;

        let html = `<span class="tooltip-date">${date}</span>`;
        if (event) {
            html += `<span class="tooltip-event">${event}</span>`;
        }
        
        if (remaining > 0) {
            html += `<div class="tooltip-countdown">${remaining} days left</div>`;
        } else {
            html += `<div class="tooltip-countdown">Happy New Year!</div>`;
        }

        tooltip.innerHTML = html;
        tooltip.style.display = 'block';

        // Positioning logic to keep tooltip on screen
        const xOffset = 15;
        const yOffset = 15;
        let x = e.clientX + xOffset;
        let y = e.clientY + yOffset;

        // Prevent overflow right/bottom
        if (x + tooltip.offsetWidth > window.innerWidth) {
            x = e.clientX - tooltip.offsetWidth - xOffset;
        }
        if (y + tooltip.offsetHeight > window.innerHeight) {
            y = e.clientY - tooltip.offsetHeight - yOffset;
        }

        tooltip.style.left = `${x}px`;
        tooltip.style.top = `${y}px`;
    }

    function hideTooltip() {
        tooltip.style.display = 'none';
    }

    // Initialize
    generateCalendar();
    
    // Re-generate if window is resized significantly (optional, CSS grid handles layout usually)
    // window.onresize = generateCalendar; 
</script>
</body>
</html>